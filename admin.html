<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin - Manage Products</title>
<style>
  body { font-family: Arial, sans-serif; padding: 20px; background: #f0f0f0; }
  table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
  th, td { border: 1px solid #ccc; padding: 5px; text-align: center; }
  th { background: #eee; }
  input { width: 60px; }
  .grade { padding: 2px 5px; border-radius: 5px; color: white; font-weight: bold; }
  button { padding: 5px 10px; margin: 2px; }
  #login { max-width: 300px; margin: 50px auto; }
</style>
</head>
<body>

<div id="login">
  <h2>Admin Login</h2>
  <input type="password" id="password" placeholder="Password">
  <button onclick="login()">Login</button>
</div>

<div id="admin" style="display:none;">
  <h1>Manage Products</h1>
  <table id="productTable">
    <thead>
      <tr>
        <th>Barcode</th><th>Name</th><th>Calories</th><th>Serving</th>
        <th>Protein</th><th>Fat</th><th>Carbs</th><th>Sugar</th><th>Fiber</th><th>Sodium</th><th>Grade</th><th>Actions</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
  <button onclick="addProduct()">Add Product</button>
  <button onclick="downloadJSON()">Download JSON</button>
</div>

<script>
const PASSWORD = "admin123"; // change password here
let products = [
  { barcode: "123456789012", name: "Apple", calories: 95, serving: "1 medium", grade: 90, nutrition: { protein: 0.5, fat: 0.3, carbs: 25, sugar: 19, fiber: 4.4, sodium: 1 } },
  { barcode: "987654321098", name: "Chocolate Bar", calories: 250, serving: "1 bar", grade: 45, nutrition: { protein: 3, fat: 13, carbs: 30, sugar: 25, fiber: 2, sodium: 50 } }
];

function login() {
  const pass = document.getElementById('password').value;
  if(pass === PASSWORD) {
    document.getElementById('login').style.display = 'none';
    document.getElementById('admin').style.display = 'block';
    renderTable();
  } else alert('Wrong password');
}

function renderTable() {
  const tbody = document.querySelector("#productTable tbody");
  tbody.innerHTML = '';
  products.forEach((p, i) => {
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td><input value="${p.barcode}" onchange="update(${i}, 'barcode', this.value)"></td>
      <td><input value="${p.name}" onchange="update(${i}, 'name', this.value)"></td>
      <td><input value="${p.calories}" type="number" onchange="update(${i}, 'calories', this.value)"></td>
      <td><input value="${p.serving}" onchange="update(${i}, 'serving', this.value)"></td>
      <td><input value="${p.nutrition.protein}" type="number" onchange="updateNutrition(${i}, 'protein', this.value)"></td>
      <td><input value="${p.nutrition.fat}" type="number" onchange="updateNutrition(${i}, 'fat', this.value)"></td>
      <td><input value="${p.nutrition.carbs}" type="number" onchange="updateNutrition(${i}, 'carbs', this.value)"></td>
      <td><input value="${p.nutrition.sugar}" type="number" onchange="updateNutrition(${i}, 'sugar', this.value)"></td>
      <td><input value="${p.nutrition.fiber}" type="number" onchange="updateNutrition(${i}, 'fiber', this.value)"></td>
      <td><input value="${p.nutrition.sodium}" type="number" onchange="updateNutrition(${i}, 'sodium', this.value)"></td>
      <td><input value="${p.grade}" type="number" onchange="update(${i}, 'grade', this.value)"></td>
      <td><button onclick="deleteProduct(${i})">Delete</button></td>
    `;
    tbody.appendChild(tr);
  });
}

function update(index, key, value) { products[index][key] = isNaN(value)? value : Number(value); renderTable(); }
function updateNutrition(index, key, value) { products[index].nutrition[key] = Number(value); renderTable(); }
function deleteProduct(index) { products.splice(index,1); renderTable(); }
function addProduct() {
  products.push({ barcode:"", name:"", calories:0, serving:"", grade:0, nutrition:{ protein:0,fat:0,carbs:0,sugar:0,fiber:0,sodium:0 }});
  renderTable();
}
function downloadJSON() {
  const blob = new Blob([JSON.stringify(products, null, 2)], {type: "application/json"});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url; a.download = "products.json"; a.click();
}
</script>
</body>
</html>
